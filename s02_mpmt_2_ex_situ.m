mPMT2.Led3.Att = [0 860 850 840 830 820 810 800];
mPMT2.Led2.Att = [0 950 940 930 920 910 900 890];
mPMT2.Led1.Att = [0 900 890 880 870 860 850 840];

mPMT2.Led3.meas(1,:) = [72274, 92029, 74831, 50188, 65934, 64813, 53829, 61274, 53573, 72680, 62021, 74772, 79569, 58301, 73025, 63762, 73970, 93194, 54624, 0];
mPMT2.Led3.meas(2,:) = [224198, 309815, 344875, 158328, 242421, 203065, 171426, 236615, 170278, 279158, 197009, 233150, 287066, 184793, 226479, 222564, 228231, 287178, 171133, 0];
mPMT2.Led3.meas(3,:) = [230011, 339694, 454799, 165168, 282597, 209480, 179335, 285313, 180781, 336560, 208074, 243746, 328325, 193988, 236262, 252010, 235800, 292660, 177677, 0];
mPMT2.Led3.meas(4,:) = [240972, 391364, 630293, 176763, 349685, 222117, 194015, 367130, 197719, 428437, 225898, 262076, 401391, 210895, 249414, 299710, 247493, 303139, 187026, 0];
mPMT2.Led3.meas(5,:) = [257345, 475880, 898188, 196880, 454618, 240383, 218344, 493798, 224139, 572846, 255361, 287531, 514139, 237616, 271263, 377379, 267481, 318724, 202331, 0];
mPMT2.Led3.meas(6,:) = [280479, 597362, 1279414, 225026, 608371, 269794, 253122, 684408, 262824, 790411, 296936, 328406, 682412, 278799, 304949, 492765, 295977, 343934, 227065, 0];
mPMT2.Led3.meas(7,:) = [321009, 783093, 1810023, 268388, 841506, 316393, 307539, 958186, 326140, 1100629, 364405, 391773, 931211, 340295, 356403, 665326, 346478, 384589, 266743, 0];
mPMT2.Led3.meas(8,:) = [374535, 1029987, 2448436, 329255, 1148629, 378351, 384698, 1313356, 410207, 1504419, 454724, 480064, 1258670, 424838, 430814, 897320, 408808, 439622, 320365, 0];

mPMT2.Led2.meas(1,:) = [69874, 82800, 55791, 49373, 58461, 63274, 51180, 52158, 51281, 62768, 59272, 71400, 70917, 55890, 71123, 57642, 71454, 89977, 52866, 0];
mPMT2.Led2.meas(2,:) = [210602, 255502, 195877, 147316, 187783, 190512, 155806, 169875, 155796, 201568, 181261, 215715, 223634, 169086, 213471, 181340, 216036, 273224, 159326, 0];
mPMT2.Led2.meas(3,:) = [219824, 298530, 331246, 157722, 240422, 199990, 166466, 235917, 168237, 275817, 195445, 229165, 282009, 182799, 224501, 223322, 226173, 278802, 167572, 0];
mPMT2.Led2.meas(4,:) = [250893, 444362, 755734, 190876, 424398, 237059, 209555, 461528, 217149, 522228, 247538, 279053, 480701, 230840, 266859, 368649, 262427, 311295, 198612, 0];
mPMT2.Led2.meas(5,:) = [327446, 787658, 1481638, 276817, 835520, 329080, 318359, 943608, 340599, 1040684, 379360, 406841, 921330, 357499, 373798, 706874, 358378, 394954, 277766, 0];
mPMT2.Led2.meas(6,:) = [489112, 1331449, 2101879, 451900, 1438129, 515364, 533222, 1573334, 588151, 1702641, 639616, 652440, 1541000, 601191, 587206, 1236713, 548048, 563602, 439816, 0];
mPMT2.Led2.meas(7,:) = [716463, 1797287, 2312314, 702635, 1875606, 770904, 825867, 1923239, 916876, 2069940, 971995, 975260, 1954757, 925087, 874146, 1673401, 812936, 794742, 668076, 0] + [44440, 111549, 144446, 43722, 116704, 48563, 51622, 119595, 57245, 128770, 60723, 60880, 121877, 57614, 54966, 104169, 50310, 49414, 41598, 0];
mPMT2.Led2.meas(8,:) = [787891, 1612958, 1990157, 790858, 1636680, 849408, 910169, 1601375, 1004462, 1757973, 1042719, 1037629, 1679956, 1003128, 948459, 1483929, 884441, 852882, 751934, 0] + [333545, 684957, 845149, 334536, 694341, 360335, 386653, 679984, 425705, 746819, 442500, 440033, 712567, 425873, 402591, 630598, 374890, 361585, 319996, 0];

mPMT2.Led1.meas(1,:) = [70738, 83272, 56514, 49312, 58696, 63940, 51221, 52740, 50744, 62740, 58993, 71770, 70458, 55285, 71831, 58035, 71278, 89852, 53531, 0];
mPMT2.Led1.meas(2,:) = [212038, 254028, 193948, 147723, 185199, 191179, 154566, 169169, 154373, 198991, 180553, 215227, 221933, 168550, 213034, 180519, 213961, 269284, 159226, 0];
mPMT2.Led1.meas(3,:) = [217139, 280830, 281076, 153194, 218190, 197256, 162054, 210176, 163249, 245740, 189641, 224475, 257828, 177797, 221149, 205092, 220809, 275852, 165790, 0];
mPMT2.Led1.meas(4,:) = [235094, 371270, 567001, 174172, 333214, 218827, 188633, 353855, 192948, 403978, 222321, 253908, 384358, 206182, 245792, 296095, 243642, 293694, 183039, 0];
mPMT2.Led1.meas(5,:) = [285008, 595265, 1133597, 229473, 613797, 279775, 257978, 688655, 273394, 766806, 307723, 333990, 682110, 284763, 312486, 516131, 303466, 348007, 233539, 0];
mPMT2.Led1.meas(6,:) = [417039, 1083608, 1836250, 373591, 1179715, 433414, 438328, 1308421, 480118, 1424046, 528418, 540477, 1273292, 485414, 484385, 992861, 459240, 482942, 365348, 0];
mPMT2.Led1.meas(7,:) = [691786, 1729906, 2178824, 671365, 1818359, 748312, 796339, 1879613, 885663, 2006480, 946719, 940799, 1894886, 879957, 832453, 1613995, 777377, 768647, 638822, 0];
mPMT2.Led1.meas(8,:) = [819873, 1561831, 1766924, 823895, 1555653, 890263, 943912, 1510354, 1043401, 1644136, 1077840, 1065104, 1587286, 1025478, 970184, 1434705, 911783, 882828, 784962, 0] + [326644, 620035, 701324, 328536, 616438, 354806, 377048, 599243, 415265, 652632, 429383, 424925, 629004, 408064, 386922, 569426, 363542, 352480, 313504, 0];

mPMT37.Led3.meas(1,:) = [70243, 36460, 65057, 35106, 54061, 62042, 58686, 60134, 62539, 71164, 64368, 66124, 119692, 37933, 83584, 162833, 42894, 43579, 66755, 0];
mPMT37.Led3.meas(2,:) = [228303, 207574, 533519, 125803, 289234, 209577, 205729, 356159, 222427, 393564, 227319, 229737, 492642, 139794, 273246, 585442, 149788, 146963, 218324, 0];
mPMT37.Led3.meas(3,:) = [245169, 293208, 795116, 144872, 395126, 232599, 233003, 502850, 254081, 543624, 257540, 260889, 607331, 165405, 297131, 669891, 168431, 162246, 234326, 0];
mPMT37.Led3.meas(4,:) = [271893, 432232, 1173549, 174217, 565733, 271761, 280485, 733755, 305321, 777594, 312802, 309839, 787347, 204338, 334795, 811122, 202076, 188794, 261280, 0];
mPMT37.Led3.meas(5,:) = [314596, 637909, 1639890, 221543, 811973, 330820, 352743, 1053001, 386340, 1103042, 393801, 387408, 1046099, 267351, 394802, 1019356, 252410, 229102, 304122, 0];
mPMT37.Led3.meas(6,:) = [378276, 900596, 2130368, 290359, 1124538, 417033, 454410, 1443888, 500103, 1498619, 507716, 497958, 1374730, 357060, 478308, 1295912, 326862, 289942, 364670, 0];
mPMT37.Led3.meas(7,:) = [471399, 1247550, 2634383, 391796, 1513599, 544446, 601171, 1902936, 664602, 1965190, 678274, 657428, 1789500, 487864, 605966, 1648452, 434799, 381055, 455468, 0];
mPMT37.Led3.meas(8,:) = [604369, 1643315, 3146403, 534134, 1941130, 715451, 804450, 2374092, 885598, 2452123, 902747, 875280, 2242199, 666545, 776763, 2056349, 584310, 505110, 580277, 0];

mPMT37.Led2.meas(1,:) = [67994, 29763, 45401, 33463, 54242, 65055, 68784, 51321, 65129, 65593, 71788, 66186, 112924, 38783, 87899, 152991, 43274, 49252, 67103, 0];
mPMT37.Led2.meas(2,:) = [210148, 103429, 181731, 104441, 180316, 199766, 208133, 177046, 199767, 222683, 223284, 203903, 355463, 120371, 268523, 473452, 133225, 151473, 201291, 0];
mPMT37.Led2.meas(3,:) = [221676, 165638, 375333, 117921, 257937, 214596, 228006, 281840, 221558, 326899, 244218, 225607, 437422, 137534, 285059, 536286, 148009, 163032, 213589, 0];
mPMT37.Led2.meas(4,:) = [263551, 375781, 931018, 164592, 509563, 274053, 299563, 618183, 302093, 665874, 326648, 302600, 701776, 200557, 343549, 746081, 197870, 204602, 255329, 0];
mPMT37.Led2.meas(5,:) = [373624, 821843, 1714986, 285115, 1028922, 422737, 476821, 1248233, 493667, 1301902, 523442, 489081, 1239385, 356901, 493126, 1201381, 327868, 311710, 363385, 0];
mPMT37.Led2.meas(6,:) = [590111, 1431368, 2222057, 519961, 1661656, 705967, 805655, 1896202, 851632, 1963565, 885352, 842364, 1894803, 654897, 777409, 1818718, 579461, 527050, 573120, 0];
mPMT37.Led2.meas(7,:) = [738119, 1510880, 2035436, 703574, 1651653, 891283, 1003413, 1799860, 1055703, 1871280, 1089800, 1053436, 1855089, 864664, 947858, 1834014, 765277, 687218, 722397, 0] + [194396, 397050, 535411, 185158, 435199, 234426, 264140, 472792, 277780, 491498, 287295, 276930, 487383, 228573, 250039, 482143, 201618, 180955, 189856, 0];
mPMT37.Led2.meas(8,:) = [812925, 1292796, 1848836, 797879, 1391144, 949051, 1044041, 1542861, 1081913, 1621890, 1109107, 1094174, 1574876, 939020, 996309, 1561589, 851740, 777595, 798138, 0] + [532725, 848891, 1210792, 522500, 912796, 623159, 684834, 1012437, 708691, 1061221, 727427, 717786, 1033150, 616390, 652483, 1024582, 557485, 508823, 524030, 0];

mPMT37.Led1.meas(1,:) = [68455, 30004, 46112, 33868, 57012, 66645, 70448, 52750, 65968, 67319, 75114, 66833, 111996, 39559, 89112, 152210, 43747, 51574, 66696, 0];
mPMT37.Led1.meas(2,:) = [208460, 99602, 166769, 103393, 181214, 202335, 215257, 173689, 201949, 218836, 229638, 205078, 350661, 120916, 271790, 467391, 133675, 156557, 201237, 0];
mPMT37.Led1.meas(3,:) = [215654, 127373, 264092, 110219, 216366, 210565, 224491, 225508, 213576, 271780, 240126, 214941, 387108, 128847, 277421, 495892, 139849, 160234, 206178, 0];
mPMT37.Led1.meas(4,:) = [236024, 229021, 573749, 132327, 341975, 237970, 258384, 399894, 251011, 447704, 277912, 252186, 519434, 157871, 305671, 597520, 163599, 181240, 227280, 0];
mPMT37.Led1.meas(5,:) = [294148, 497341, 1219163, 196337, 666977, 318476, 352845, 827307, 358525, 881643, 387674, 355715, 865930, 242067, 384803, 874667, 232128, 236375, 282716, 0];
mPMT37.Led1.meas(6,:) = [428175, 992881, 1871524, 343360, 1225095, 499558, 565429, 1470310, 597595, 1534410, 626246, 589698, 1445214, 431895, 564066, 1375652, 387301, 366678, 412568, 0];
mPMT37.Led1.meas(7,:) = [704422, 1583462, 2166980, 642168, 1793407, 856035, 972728, 1972020, 1032799, 2047098, 1067190, 1021329, 2017290, 802400, 914371, 1969555, 701697, 635276, 679436, 0] + [10871, 24264, 33320, 9805, 27484, 13246, 15008, 30485, 15898, 31344, 16379, 15794, 31001, 12221, 14157, 30385, 10792, 9886, 10416, 0];
mPMT37.Led1.meas(8,:) = [806256, 1340584, 1740555, 781631, 1437308, 958085, 1060666, 1542685, 1108869, 1618051, 1136205, 1114580, 1609428, 932194, 999577, 1627688, 833156, 757788, 784698, 0] + [373797, 621765, 808706, 363112, 665947, 446282, 492585, 716765, 514907, 751565, 526436, 517580, 746829, 432159, 463686, 755033, 386167, 351481, 362924, 0];


%figure; plot(mPMT5.Led3.Att(2:end)', mPMT5.Led3.meas(2:end,1) - mPMT5.Led3.meas(1,1), "*", mPMT37.Led3.Att(2:end)', mPMT37.Led3.meas(2:end,1) - mPMT37.Led3.meas(1,1), ".-");

mPMT2.Led3.Abs = mPMT2.Led3.meas(3:end,:) - 3*mPMT2.Led3.meas(1,:);
mPMT2.Led2.Abs = mPMT2.Led2.meas(3:end,:) - 3*mPMT2.Led2.meas(1,:);
mPMT2.Led1.Abs = mPMT2.Led1.meas(3:end,:) - 3*mPMT2.Led1.meas(1,:);

mPMT37.Led3.Abs = mPMT37.Led3.meas(3:end,:) - 3*mPMT37.Led3.meas(1,:);
mPMT37.Led2.Abs = mPMT37.Led2.meas(3:end,:) - 3*mPMT37.Led2.meas(1,:);
mPMT37.Led1.Abs = mPMT37.Led1.meas(3:end,:) - 3*mPMT37.Led1.meas(1,:);

% 
% mPMT5.Led3.Abs = mPMT5.Led3.meas(2:end,:);
% mPMT5.Led2.Abs = mPMT5.Led2.meas(2:end,:);
% mPMT5.Led1.Abs = mPMT5.Led1.meas(2:end,:);
% 
% mPMT37.Led3.Abs = mPMT37.Led3.meas(2:end,:);
% mPMT37.Led2.Abs = mPMT37.Led2.meas(2:end,:);
% mPMT37.Led1.Abs = mPMT37.Led1.meas(2:end,:);

pmtHitRatio.Led3 = mPMT37.Led3.Abs ./ mPMT2.Led3.Abs;
pmtHitRatio.Led2 = mPMT37.Led2.Abs ./ mPMT2.Led2.Abs;
pmtHitRatio.Led1 = mPMT37.Led1.Abs ./ mPMT2.Led1.Abs;

figure; plot(mPMT37.Led3.Att(3:end)', mPMT37.Led3.Abs(:,1), "*", mPMT2.Led3.Att(3:end)', mPMT2.Led3.Abs(:,1), "*"); grid on; xlabel("LED attenuation"); ylabel("Hit count (180s meas)"); title("Hit count mPMT37 (in-situ) (red) vs mPMT5 (ex-situ) (blue) central PMT (LED 365nm)");
figure; plot(mPMT37.Led2.Att(3:end)', mPMT37.Led2.Abs(:,1), "*", mPMT2.Led2.Att(3:end)', mPMT2.Led2.Abs(:,1), "*"); grid on; xlabel("LED attenuation"); ylabel("Hit count (180s meas)"); title("Hit count mPMT37 (in-situ) (red) vs mPMT5 (ex-situ) (blue) central PMT (LED 405nm)");
figure; plot(mPMT37.Led1.Att(3:end)', mPMT37.Led1.Abs(:,1), "*", mPMT2.Led1.Att(3:end)', mPMT2.Led1.Abs(:,1), "*"); grid on; xlabel("LED attenuation"); ylabel("Hit count (180s meas)"); title("Hit count mPMT37 (in-situ) (red) vs mPMT5 (ex-situ) (blue) central PMT (LED 470nm)");

figure; plot(mPMT37.Led3.Att(3:end)', mPMT37.Led3.Abs(:,2), "*", mPMT2.Led3.Att(3:end)', mPMT2.Led3.Abs(:,2), "*"); grid on; xlabel("LED attenuation"); ylabel("Hit count (180s meas)"); title("Hit count mPMT37 (in-situ) (red) vs mPMT5 (ex-situ) (blue) central PMT (LED 365nm)");
figure; plot(mPMT37.Led2.Att(3:end)', mPMT37.Led2.Abs(:,2), "*", mPMT2.Led2.Att(3:end)', mPMT2.Led2.Abs(:,2), "*"); grid on; xlabel("LED attenuation"); ylabel("Hit count (180s meas)"); title("Hit count mPMT37 (in-situ) (red) vs mPMT5 (ex-situ) (blue) central PMT (LED 405nm)");
figure; plot(mPMT37.Led1.Att(3:end)', mPMT37.Led1.Abs(:,2), "*", mPMT2.Led1.Att(3:end)', mPMT2.Led1.Abs(:,2), "*"); grid on; xlabel("LED attenuation"); ylabel("Hit count (180s meas)"); title("Hit count mPMT37 (in-situ) (red) vs mPMT5 (ex-situ) (blue) central PMT (LED 470nm)");

figure; plot(mPMT37.Led3.Att(3:end)', pmtHitRatio.Led3, "-*"); grid on; xlabel("LED attenuation"); ylabel("Hit count ratio"); title("Hit count ratio - mPMT37 (in-situ) vs mPMT5 (ex-situ) (blue) central"); legend("Ch" + [0:19]);
figure; plot(mPMT37.Led2.Att(3:end)', pmtHitRatio.Led2, "-*"); grid on; xlabel("LED attenuation"); ylabel("Hit count ratio"); title("Hit count ratio - mPMT37 (in-situ) vs mPMT5 (ex-situ) (blue) central");
figure; plot(mPMT37.Led1.Att(3:end)', pmtHitRatio.Led1, "-*"); grid on; xlabel("LED attenuation"); ylabel("Hit count ratio"); title("Hit count ratio - mPMT37 (in-situ) vs mPMT5 (ex-situ) (blue) central");


figure; plot(0:18, mean(pmtHitRatio.Led1(:,1:19)), "*-", 0:18, mean(pmtHitRatio.Led2(:,1:19)), "*-", 0:18, mean(pmtHitRatio.Led3(:,1:19)), "*-"); grid on; legend("470nm", "407nm", "365nm"); ylabel("Mean count ratio"); xlabel("mPMT channel"); title("Mean count ratio mPMT37 (in-situ) vs mPMT5 (ex-situ)");

