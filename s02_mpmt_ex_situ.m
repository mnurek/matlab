%%
mPMT2.Led3.Att = [680 690 700 710 720 730];
mPMT2.Led2.Att = [920 930 940 950 960];
mPMT2.Led1.Att = [870 880 890 900 910];

mPMT2Clean.Led3.Att = [680 690 700 710 720 730];
mPMT2Clean.Led2.Att = [920 930 940 950 960];
mPMT2Clean.Led1.Att = [870 880 890 900 910];
%%
mPMT2.Led3.meas(1,:) = [287829, 734727, 1624870, 388666, 612970, 239771, 239565, 833593, 256785, 1061839, 291841, 312018, 1118866, 395442, 277706, 851074, 301957, 0, 315530, 0];
mPMT2.Led3.meas(2,:) = [231805, 532070, 1126228, 338961, 441953, 193816, 200167, 601649, 206528, 748711, 236916, 253895, 812560, 310908, 212194, 600438, 239445, 0, 255709, 0];
mPMT2.Led3.meas(3,:) = [195711, 391736, 779450, 306491, 324175, 162299, 171720, 440515, 173314, 530005, 199981, 212113, 599987, 255710, 168060, 427015, 197631, 0, 215517, 0];
mPMT2.Led3.meas(4,:) = [172049, 301133, 553810, 284281, 246951, 141594, 153613, 336238, 152004, 388402, 176776, 187737, 461882, 220472, 138355, 315861, 170182, 0, 190454, 0];
mPMT2.Led3.meas(5,:) = [153750, 231390, 377950, 267719, 188872, 125262, 140184, 256203, 134549, 279380, 156842, 167865, 355448, 192483, 115819, 227884, 148283, 0, 169972, 0];
mPMT2.Led3.meas(6,:) = [143218, 189661, 271938, 258070, 151924, 116350, 131374, 208335, 124855, 215170, 146452, 155675, 291723, 174570, 102990, 176269, 135601, 0, 158586, 0];
mPMT2.Led3.dr = [122824, 117564, 90982, 240608, 91863, 99629, 117703, 123638, 105997, 101047, 126844, 134103, 180544, 145741, 78747, 85744, 112772, 0, 135636, 0];

mPMT2.Led2.meas(1,:) = [674515, 2038695, 4031874, 696790, 1788744, 583131, 527040, 2286867, 625067, 2764127, 658418, 731592, 2867121, 932900, 777979, 2371223, 742897, 0, 735033, 0] + [592753, 1797024, 3555087, 613986, 1576124, 514107, 465227, 2016025, 550273, 2438540, 580172, 643635, 2529068, 822550, 686439, 2087347, 654459, 0, 649719, 0];
mPMT2.Led2.meas(2,:) = [506900, 1424664, 2971740, 603873, 1237907, 433603, 409804, 1615933, 466791, 1950749, 501624, 553626, 2078051, 690780, 544254, 1647324, 545266, 0, 556979, 0];
mPMT2.Led2.meas(3,:) = [207355, 406358, 750630, 323820, 342617, 172288, 180494, 454814, 185704, 517391, 209930, 227836, 604947, 263844, 180475, 433692, 207193, 0, 227766, 0];
mPMT2.Led2.meas(4,:) = [138955, 168462, 210057, 262154, 136451, 111841, 128632, 183609, 121112, 177167, 144996, 153870, 255861, 167416, 97621, 148500, 130265, 0, 152736, 0];
mPMT2.Led2.meas(5,:) = [126361, 122610, 105135, 248025, 96134, 100240, 118935, 130736, 108249, 110667, 131650, 140813, 188439, 147430, 80674, 92866, 115703, 0, 137540, 0];
mPMT2.Led2.dr = [122666, 115253, 90440, 247375, 92556, 98890, 117957, 124327, 107003, 100731, 130365, 140642, 178004, 143264, 78640, 85045, 113321, 0, 135115, 0];

mPMT2.Led1.meas(1,:) = [682336, 1985860, 4043236, 823434, 1726025, 572339, 543958, 2283175, 624677, 2736586, 717041, 781565, 2850127, 941125, 780257, 2331246, 759622, 0, 751570, 0] + [297233, 865484, 1761380, 357085, 753718, 250099, 236273, 992180, 272895, 1190480, 311383, 340272, 1241640, 411526, 339038, 1015494, 331710, 0, 327490, 0];
mPMT2.Led1.meas(2,:) = [396269, 957177, 1961046, 636520, 820670, 309799, 333144, 1116144, 349001, 1302370, 448221, 482466, 1408719, 504159, 388239, 1096284, 411615, 0, 422705, 0];
mPMT2.Led1.meas(3,:) = [211877, 334406, 583080, 459927, 279262, 151918, 193584, 399133, 179037, 411322, 264555, 278144, 494592, 236884, 160013, 347098, 198350, 0, 215188, 0];
mPMT2.Led1.meas(4,:) = [164042, 171054, 207754, 411901, 138143, 111294, 156846, 209230, 134163, 175588, 215830, 225610, 252943, 166169, 100734, 148424, 141451, 0, 162470, 0];
mPMT2.Led1.meas(5,:) = [151820, 131921, 121536, 399563, 104321, 101329, 147747, 164158, 121978, 120612, 201247, 212129, 195434, 151083, 86721, 101845, 128177, 0, 149577, 0];
mPMT2.Led1.dr = [152153, 122985, 98198, 405329, 96987, 98604, 148808, 154085, 121132, 107665, 205692, 213071, 181231, 146262, 82150, 90192, 124981, 0, 147624, 0];

mPMT2Clean.Led3.meas(1,:) = [362492, 886075, 1549629, 316053, 656724, 215629, 233627, 727045, 239481, 805199, 244865, 235657, 933642, 336830, 237817, 954086, 359923, 0, 340075, 0];
mPMT2Clean.Led3.meas(2,:) = [300094, 634513, 1074021, 273305, 472747, 175939, 188301, 528666, 192247, 571059, 198345, 187015, 678695, 277982, 190652, 675501, 302774, 0, 276798, 0];
mPMT2Clean.Led3.meas(3,:) = [258302, 465226, 753922, 244747, 351112, 149189, 157254, 395080, 160684, 414106, 167775, 155704, 509019, 241661, 160163, 488773, 265812, 0, 233979, 0];
mPMT2Clean.Led3.meas(4,:) = [232257, 347811, 525941, 226986, 262544, 129780, 137204, 299160, 138663, 306579, 146561, 132977, 387793, 216838, 139600, 357343, 241819, 0, 202677, 0];
mPMT2Clean.Led3.meas(5,:) = [219233, 272921, 383831, 217133, 209785, 118509, 122256, 241968, 124861, 236214, 134092, 119390, 311301, 204196, 128366, 275927, 231279, 0, 185163, 0];
mPMT2Clean.Led3.meas(6,:) = [209637, 221758, 283423, 210666, 173112, 111631, 112225, 201328, 116974, 189954, 124576, 110107, 258144, 193501, 119957, 218155, 223484, 0, 174939, 0];
mPMT2Clean.Led3.dr = [162602, 122593, 102372, 182246, 97754, 92414, 98690, 120366, 98146, 100925, 106628, 90394, 166822, 160062, 93903, 105241, 172789, 0, 142582, 0];

mPMT2Clean.Led2.meas(1,:) = [843962, 2523278, 4076817, 620827, 2002085, 538943, 596087, 2137755, 631768, 2301160, 586789, 624572, 2606731, 745150, 625641, 2707926, 800494, 0, 846214, 0] + [665951, 1993022, 3219798, 492213, 1581941, 425165, 470720, 1686817, 497537, 1818223, 461818, 492268, 2057654, 588854, 496565, 2141600, 633293, 0, 667575, 0];
mPMT2Clean.Led2.meas(2,:) = [589093, 1654407, 2784961, 480994, 1288672, 376796, 417725, 1397593, 434334, 1495454, 416226, 426720, 1745663, 540392, 424928, 1771836, 564757, 0, 591405, 0];
mPMT2Clean.Led2.meas(3,:) = [250792, 504896, 791641, 249845, 392409, 162746, 180313, 441133, 180265, 450521, 185059, 172454, 570938, 248188, 167595, 518969, 246451, 0, 249904, 0];
mPMT2Clean.Led2.meas(4,:) = [156260, 181566, 214050, 187129, 141522, 105307, 115922, 173340, 111810, 160233, 120943, 103341, 239508, 168830, 97950, 168031, 157950, 0, 157216, 0];
mPMT2Clean.Led2.meas(5,:) = [139184, 124053, 108791, 175753, 97213, 94381, 104681, 125658, 98107, 106552, 111144, 90979, 180672, 153706, 84921, 103251, 141209, 0, 141756, 0];
mPMT2Clean.Led2.dr = [146604, 117965, 97002, 176089, 92528, 92052, 100312, 118951, 96708, 99728, 108666, 89741, 169949, 153573, 86382, 98006, 149943, 0, 138791, 0];

mPMT2Clean.Led1.meas(1,:) = [831080, 2497476, 4153964, 636146, 1939201, 541932, 585089, 2105368, 615467, 2293766, 593806, 623774, 2648127, 762569, 643052, 2747697, 816282, 0, 881127, 0] + [308060, 922146, 1536388, 235495, 716251, 200859, 216346, 776703, 226832, 847244, 218991, 230141, 977971, 281922, 237404, 1015253, 301449, 0, 325093, 0];
mPMT2Clean.Led1.meas(2,:) = [404340, 1079853, 1828183, 361507, 827139, 271633, 295367, 918939, 303997, 983643, 303810, 300267, 1187335, 394385, 298535, 1172166, 394846, 0, 431457, 0];
mPMT2Clean.Led1.meas(3,:) = [190650, 358827, 539194, 212661, 272404, 136918, 150370, 321022, 146954, 322903, 155482, 139854, 431568, 204888, 130633, 362711, 183921, 0, 208762, 0];
mPMT2Clean.Led1.meas(4,:) = [134463, 167299, 191346, 176886, 128217, 102582, 113136, 162899, 108099, 148236, 119152, 99608, 230789, 155703, 87561, 148508, 131782, 0, 149305, 0];
mPMT2Clean.Led1.meas(5,:) = [121750, 121695, 107808, 164828, 94146, 94559, 103489, 125841, 97273, 106946, 109493, 89907, 181400, 144843, 77542, 97965, 117456, 0, 136558, 0];
mPMT2Clean.Led1.dr = [119671, 111224, 87945, 164020, 86469, 92015, 102330, 118248, 95742, 97180, 108152, 88124, 171780, 142129, 75411, 85846, 114960, 0, 132861, 0];

%%
%figure; plot(mPMT5.Led3.Att(2:end)', mPMT5.Led3.meas(2:end,1) - mPMT5.Led3.meas(1,1), "*", mPMT37.Led3.Att(2:end)', mPMT37.Led3.meas(2:end,1) - mPMT37.Led3.meas(1,1), ".-");

mPMT2.Led3.Abs = mPMT2.Led3.meas(1:5,:) - mPMT2.Led3.dr;
mPMT2.Led2.Abs = mPMT2.Led2.meas(1:5,:) - mPMT2.Led2.dr;
mPMT2.Led1.Abs = mPMT2.Led1.meas(1:5,:) - mPMT2.Led1.dr;

mPMT2Clean.Led3.Abs = mPMT2Clean.Led3.meas(1:5,:) - mPMT2Clean.Led3.dr;
mPMT2Clean.Led2.Abs = mPMT2Clean.Led2.meas(1:5,:) - mPMT2Clean.Led2.dr;
mPMT2Clean.Led1.Abs = mPMT2Clean.Led1.meas(1:5,:) - mPMT2Clean.Led1.dr;

% 
% mPMT5.Led3.Abs = mPMT5.Led3.meas(2:end,:);
% mPMT5.Led2.Abs = mPMT5.Led2.meas(2:end,:);
% mPMT5.Led1.Abs = mPMT5.Led1.meas(2:end,:);
% 
% mPMT37.Led3.Abs = mPMT37.Led3.meas(2:end,:);
% mPMT37.Led2.Abs = mPMT37.Led2.meas(2:end,:);
% mPMT37.Led1.Abs = mPMT37.Led1.meas(2:end,:);

pmtHitRatio.Led3 = mPMT2Clean.Led3.Abs(1:4,:) ./ mPMT2.Led3.Abs(1:4,:);
pmtHitRatio.Led2 = mPMT2Clean.Led2.Abs(1:4,:) ./ mPMT2.Led2.Abs(1:4,:);
pmtHitRatio.Led1 = mPMT2Clean.Led1.Abs(1:4,:) ./ mPMT2.Led1.Abs(1:4,:);

%%
figure; plot(mPMT2Clean.Led3.Att(1:4)', mPMT2Clean.Led3.Abs(1:4,1), "-*", mPMT2.Led3.Att(1:4)', mPMT2.Led3.Abs(1:4,1), "-*"); grid on; xlabel("LED attenuation"); ylabel("Hit count (180s meas)"); title("Hit count mPMT37 (in-situ) (red) vs mPMT5 (ex-situ) (blue) central PMT (LED 365nm)");
figure; plot(mPMT2Clean.Led2.Att(1:4)', mPMT2Clean.Led2.Abs(1:4,1), "-*", mPMT2.Led2.Att(1:4)', mPMT2.Led2.Abs(1:4,1), "-*"); grid on; xlabel("LED attenuation"); ylabel("Hit count (180s meas)"); title("Hit count mPMT37 (in-situ) (red) vs mPMT5 (ex-situ) (blue) central PMT (LED 405nm)");
figure; plot(mPMT2Clean.Led1.Att(1:4)', mPMT2Clean.Led1.Abs(1:4,1), "-*", mPMT2.Led1.Att(1:4)', mPMT2.Led1.Abs(1:4,1), "-*"); grid on; xlabel("LED attenuation"); ylabel("Hit count (180s meas)"); title("Hit count mPMT37 (in-situ) (red) vs mPMT5 (ex-situ) (blue) central PMT (LED 470nm)");

figure; plot(mPMT2Clean.Led3.Att(1:4)', mPMT2Clean.Led3.Abs(1:4,4), "-*", mPMT2.Led3.Att(1:4)', mPMT2.Led3.Abs(1:4,4), "-*"); grid on; xlabel("LED attenuation"); ylabel("Hit count (180s meas)"); title("Hit count mPMT37 (in-situ) (red) vs mPMT5 (ex-situ) (blue) central PMT (LED 365nm)");
figure; plot(mPMT2Clean.Led2.Att(1:4)', mPMT2Clean.Led2.Abs(1:4,4), "-*", mPMT2.Led2.Att(1:4)', mPMT2.Led2.Abs(1:4,4), "-*"); grid on; xlabel("LED attenuation"); ylabel("Hit count (180s meas)"); title("Hit count mPMT37 (in-situ) (red) vs mPMT5 (ex-situ) (blue) central PMT (LED 405nm)");
figure; plot(mPMT2Clean.Led1.Att(1:4)', mPMT2Clean.Led1.Abs(1:4,4), "-*", mPMT2.Led1.Att(1:4)', mPMT2.Led1.Abs(1:4,4), "-*"); grid on; xlabel("LED attenuation"); ylabel("Hit count (180s meas)"); title("Hit count mPMT37 (in-situ) (red) vs mPMT5 (ex-situ) (blue) central PMT (LED 470nm)");

figure; plot(mPMT2Clean.Led3.Att(1:4)', pmtHitRatio.Led3, "-*"); grid on; xlabel("LED attenuation"); ylabel("Hit count ratio"); title("Hit count ratio (LED 365nm) - mPMT37 (in-situ) vs mPMT5 (ex-situ) - all 19 channels");
figure; plot(mPMT2Clean.Led2.Att(1:4)', pmtHitRatio.Led2, "-*"); grid on; xlabel("LED attenuation"); ylabel("Hit count ratio"); title("Hit count ratio (LED 405nm) - mPMT37 (in-situ) vs mPMT5 (ex-situ) - all 19 channels");
figure; plot(mPMT2Clean.Led1.Att(1:4)', pmtHitRatio.Led1, "-*"); grid on; xlabel("LED attenuation"); ylabel("Hit count ratio"); title("Hit count ratio (LED 470nm) - mPMT37 (in-situ) vs mPMT5 (ex-situ) - all 19 channels");


figure; plot(0:18, mean(pmtHitRatio.Led1(:,1:19)), "*-", 0:18, mean(pmtHitRatio.Led2(:,1:19)), "*-", 0:18, mean(pmtHitRatio.Led3(:,1:19)), "*-"); grid on; legend("470nm", "407nm", "365nm"); ylabel("Mean count ratio"); xlabel("mPMT channel"); title("Mean count ratio mPMT37 (in-situ) vs mPMT5 (ex-situ)");

